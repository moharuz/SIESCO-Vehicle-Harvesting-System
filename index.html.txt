<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SIESCO Vehicle Harvesting System - SCADA Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #1e1e1e;
      color: #f0f0f0;
    }
    header {
      padding: 10px;
      text-align: center;
      background: #111;
      font-size: 1.5em;
      font-weight: bold;
      color: #4cafef;
    }
    nav {
      display: flex;
      justify-content: center;
      background: #222;
    }
    nav button {
      background: #333;
      color: #fff;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
      border-radius: 5px;
    }
    nav button.active {
      background: #4cafef;
    }
    .tab {
      display: none;
      padding: 20px;
    }
    .tab.active {
      display: block;
    }
    .kpi-container {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .kpi {
      background: #2c2c2c;
      padding: 15px;
      margin: 10px;
      border-radius: 10px;
      flex: 1;
      min-width: 180px;
      text-align: center;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    .scada-diagram {
      text-align: center;
      margin-top: 20px;
    }
    canvas {
      background: #2c2c2c;
      border-radius: 10px;
      padding: 10px;
      margin-top: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table th, table td {
      border: 1px solid #555;
      padding: 8px;
      text-align: center;
    }
    table th {
      background: #333;
    }
  </style>
</head>
<body>
  <header>
    ⚡ SIESCO Vehicle Harvesting System - SCADA Dashboard ⚡
  </header>

  <nav>
    <button class="active" onclick="openTab('scada')">SCADA</button>
    <button onclick="openTab('summary')">Performance Summary</button>
    <button onclick="openTab('vehicles')">Vehicles</button>
    <button onclick="openTab('solar')">Solar</button>
    <button onclick="openTab('wind')">Wind</button>
    <button onclick="openTab('diesel')">Diesel</button>
    <button onclick="openTab('battery')">Battery</button>
    <button onclick="openTab('grid')">Grid</button>
    <button onclick="openTab('load')">Load</button>
  </nav>

  <!-- SCADA TAB -->
  <div id="scada" class="tab active">
    <div class="scada-diagram">
      <h2>SCADA Power Flow</h2>
      <p>Vehicles → Inverter → Grid / Battery → Load</p>
    </div>
    <div class="kpi-container">
      <div class="kpi">
        <h3>Total Vehicles</h3>
        <p id="kpiVehicles">0</p>
      </div>
      <div class="kpi">
        <h3>Total Generation (kWh)</h3>
        <p id="kpiGen">0</p>
      </div>
      <div class="kpi">
        <h3>Battery Level (kWh)</h3>
        <p id="kpiBattery">0</p>
      </div>
      <div class="kpi">
        <h3>Financial (SAR)</h3>
        <p id="kpiMoney">0</p>
      </div>
    </div>
    <canvas id="genChart" height="100"></canvas>
  </div>

  <!-- SUMMARY TAB -->
  <div id="summary" class="tab">
    <h2>Performance Summary</h2>
    <table>
      <tr>
        <th>Period</th>
        <th>Energy (kWh)</th>
        <th>Value (SAR)</th>
      </tr>
      <tr><td>Last Hour</td><td id="sumHourE">0</td><td id="sumHourM">0</td></tr>
      <tr><td>Day</td><td id="sumDayE">0</td><td id="sumDayM">0</td></tr>
      <tr><td>Week</td><td id="sumWeekE">0</td><td id="sumWeekM">0</td></tr>
      <tr><td>Month</td><td id="sumMonthE">0</td><td id="sumMonthM">0</td></tr>
      <tr><td>Year</td><td id="sumYearE">0</td><td id="sumYearM">0</td></tr>
      <tr><td>Total</td><td id="sumTotalE">0</td><td id="sumTotalM">0</td></tr>
    </table>
  </div>

  <!-- VEHICLES TAB -->
  <div id="vehicles" class="tab">
    <h2>Vehicles Generation</h2>
    <canvas id="vehChart" height="100"></canvas>
  </div>

  <!-- SOLAR TAB -->
  <div id="solar" class="tab">
    <h2>Solar Generation</h2>
    <canvas id="solChart" height="100"></canvas>
  </div>

  <!-- WIND TAB -->
  <div id="wind" class="tab">
    <h2>Wind Generation</h2>
    <canvas id="winChart" height="100"></canvas>
  </div>

  <!-- DIESEL TAB -->
  <div id="diesel" class="tab">
    <h2>Diesel Generator</h2>
    <canvas id="dieChart" height="100"></canvas>
  </div>

  <!-- BATTERY TAB -->
  <div id="battery" class="tab">
    <h2>Battery Storage</h2>
    <canvas id="batChart" height="100"></canvas>
  </div>

  <!-- GRID TAB -->
  <div id="grid" class="tab">
    <h2>Grid Interaction</h2>
    <canvas id="griChart" height="100"></canvas>
  </div>

  <!-- LOAD TAB -->
  <div id="load" class="tab">
    <h2>Load Demand</h2>
    <canvas id="loaChart" height="100"></canvas>
  </div>

<script>
let totalVehicles = 0;
let totalGen = 0;
let totalMoney = 0;
let batteryLevel = 0;
let pricePerKWh = 0.30;
let cumulativeGen = [];

function randomVehicles() {
  // Poisson approx ~1000 vehicles/hour ≈ 0.28 vehicles/sec
  return Math.random() < 1000/3600 ? 1 : 0;
}
function vehicleEnergy() {
  let v = (30 + Math.random()*20) * 1000/3600; // m/s
  let m = 1500; // kg
  let KE = 0.5*m*v*v;
  let energy = KE*2*30*0.25; // J
  return energy/3600000; // kWh
}

// Charts
let genChart = new Chart(document.getElementById('genChart'), {
  type: 'line',
  data: {labels:[], datasets:[{label:'Total Generation (kWh)',data:[],borderColor:'#4cafef'}]},
  options:{scales:{x:{ticks:{color:'#ccc'}},y:{ticks:{color:'#ccc'}}}}
});
function addData(chart, label, data) {
  chart.data.labels.push(label);
  chart.data.datasets[0].data.push(data);
  if(chart.data.labels.length>50){chart.data.labels.shift(); chart.data.datasets[0].data.shift();}
  chart.update();
}

// Simulation loop
setInterval(()=>{
  let vehCount = randomVehicles();
  let vehEnergy = 0;
  for(let i=0;i<vehCount;i++){vehEnergy += vehicleEnergy();}
  totalVehicles += vehCount;
  totalGen += vehEnergy;
  totalMoney = totalGen*pricePerKWh;
  batteryLevel = (batteryLevel + vehEnergy*0.5);

  // Update KPIs
  document.getElementById('kpiVehicles').innerText = totalVehicles;
  document.getElementById('kpiGen').innerText = totalGen.toFixed(2);
  document.getElementById('kpiBattery').innerText = batteryLevel.toFixed(2);
  document.getElementById('kpiMoney').innerText = totalMoney.toFixed(2);

  // Chart update
  addData(genChart,new Date().toLocaleTimeString(),totalGen);

  // Summary update (approx scaling)
  document.getElementById('sumHourE').innerText = (totalGen/1).toFixed(2);
  document.getElementById('sumHourM').innerText = (totalGen*pricePerKWh/1).toFixed(2);
  document.getElementById('sumDayE').innerText = (totalGen).toFixed(2);
  document.getElementById('sumDayM').innerText = (totalMoney).toFixed(2);
  document.getElementById('sumWeekE').innerText = (totalGen*7).toFixed(2);
  document.getElementById('sumWeekM').innerText = (totalMoney*7).toFixed(2);
  document.getElementById('sumMonthE').innerText = (totalGen*30).toFixed(2);
  document.getElementById('sumMonthM').innerText = (totalMoney*30).toFixed(2);
  document.getElementById('sumYearE').innerText = (totalGen*365).toFixed(2);
  document.getElementById('sumYearM').innerText = (totalMoney*365).toFixed(2);
  document.getElementById('sumTotalE').innerText = totalGen.toFixed(2);
  document.getElementById('sumTotalM').innerText = totalMoney.toFixed(2);
},1000);

function openTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
}
</script>
</body>
</html>
